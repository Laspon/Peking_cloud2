<div class="box" id="login">
    <div>
    <!--<div class="login-header">-->
        <!--<h2>请输入用户名密码</h2>-->
        <!--<span class="fa-stack fa-2x hidden-xs">-->
          <!--<i class="fa fa-circle fa-stack-2x"></i>-->
          <!--<i class="fa fa-lock fa-stack-1x fa-inverse"></i> &lt;!&ndash;上锁图标&ndash;&gt;-->
        <!--</span>-->
    <!--</div>-->

    <form method="post" id="fm1" th:object="${credential}" class="form-horizontal">

        <div class="alert alert-danger" th:if="${#fields.hasErrors('*')}">
            <span th:each="err : ${#fields.errors('*')}" th:utext="${err}"/>
        </div>

        <h2 th:utext="#{screen.welcome.instructions}"></h2>
        
        <section class="row">

            <!--<div style="position:relative">-->
                <!--<i class="fa fa-university icon_font"></i>-->
            <!--<label for="jsbhchoice" th:utext="#{screen.welcome.label.jsbh}" class="col-sm-4" style="font-size:18px;color:#DCDCDC;"/>-->
            <!--</div>-->

            <div class="col-sm-8">
            	<div id="zTree">
			    	<input autocomplete="off" id="txtTreeSelect" type="text" onclick="showMenu(); return false;" class="required form-control" style="font-size: 1.4em;padding:0em 0em 0.2em 0.6em;;text-indent: 25px" placeholder="监所名称"/>
			    	<input type="hidden" name="jsbhchoice" id="jsbhfm"/>
			    </div>
			    <div id="menuContent" class="zTreeDemoBackground left" style="width:100%;height:auto;display: none;position: absolute;z-index: 10;">
				    <ul id="treeDemo" class="ztree"></ul>
				</div>
            	<!-- <select class="required form-control" name="jsbhchoice" style="font-size: 1.8rem;padding:0em 0em 0.2em 0.6em;;text-indent: 25px">
            			<option th:name = "jsbhchoice" th:value="000000000" >平台管理员</option>
            			<option th:name = "jsbhchoice" th:value="310000000">上海市监管总队</option>
                        <option th:name = "jsbhchoice" th:value="310000111">上海市第一看守所</option>
	                    <option th:name = "jsbhchoice" th:value="310000112">上海市第二看守所</option>
	                    <option th:name = "jsbhchoice" th:value="110000111">北京市第一看守所</option>
	                    <option th:name = "jsbhchoice" th:value="110000112">北京市第二看守所</option>
	                    <option th:name = "jsbhchoice" th:value="110000113">北京市第三看守所</option>
                       <option  th:each="list:${session.list}" th:value="${list.cid}" th:text="${list.cname }"></option>
            	</select> -->
                <i class="fa fa-university icon_font" style="top: 4px;"></i>
                <!--<input class="required col-sm-10"
                       type="text"
                       id="jsbhchoice"
                       size="25"
                       tabindex="1"
                       name="jsbhchoice"
                       th:accesskey="#{screen.welcome.label.jsbh.accesskey}"
                       autocomplete="off"/>-->

            </div>
        </section>

        <section class="row">
            <!--<div style="position:relative">-->
            <!--<i class="fa fa-user icon_font"></i>-->
            <!--<label for="loginname" th:utext="#{screen.welcome.label.netid}" class="col-sm-4" style="font-size:18px;color:#DCDCDC;"/>-->
            <!--</div>-->

            <div class="col-sm-8">

                <input class="required"
                       type="text"
                       id="loginname"
                       size="25"
                       name="loginname"
                       placeholder="用户名"
                       tabindex="1"
                       th:accesskey="#{screen.welcome.label.netid.accesskey}"
                       autocomplete="off"/>
               <i class="fa fa-user icon_font"></i>
               <!--    <span id="loginname-null" style="display:none;">
                    <p>
                        <i class="fa fa-exclamation-circle" style="color:red"></i>
                        <span th:utext="#{screen.span.loginname.null}" style="color:white"/>
                    </p>   当用户名为空时底下显示：“请输入用户名”--> 
                </span>
            </div>
        </section>

        <section class="row">
            <!--<div style="position:relative">-->
            <!--<i class="fa fa-key icon_font"></i>-->
            <!--<label for="password" th:utext="#{screen.welcome.label.password}" class="col-sm-4" style="font-size:18px;color:#DCDCDC;"/>-->
            <!--</div>-->

            <div class="col-sm-8">
                <input class="required"
                       type="password"
                       id="password"
                       size="25"
                       placeholder="密码"
                       tabindex="3"
                       th:accesskey="#{screen.welcome.label.password.accesskey}"
                       th:field="*{password}"
                       autocomplete="off"/>
                <i class="fa fa-key icon_font"></i>
                <span id="capslock-on" style="display:none;">
                    <p>
                        <i class="fa fa-exclamation-circle"></i>
                        <span th:utext="#{screen.span.capslock.on}"/>
                    </p>
                </span>
            </div>
        </section>
        <section class="row check">
            <p th:if="${rememberMeAuthenticationEnabled}">
                <input type="checkbox" name="rememberMe" id="rememberMe" value="true" tabindex="5"  />
                <label for="rememberMe" th:text="#{screen.rememberme.checkbox.title}"/>
            </p>
        </section>
        
        <section class="row" th:if="${recaptchaSiteKey}">
            <div class="g-recaptcha" th:attr="data-sitekey=${recaptchaSiteKey}"/>
        </section>

        <section class="row btn-row">
        	<input type="hidden" name="username" />
        	<input type="hidden" name="jsbh"     />
            <input type="hidden" name="execution" th:value="${flowExecutionKey}"/>
            <input type="hidden" name="_eventId" value="submit"/>
            <input type="hidden" name="geolocation"/>

            <input class="btn btn-submit btn-block"
                   name="submit"
                   accesskey="l"
                   style="margin-top: 2%;margin-left: 3%;height: 46px;width: 95%;"
                   th:value="#{screen.welcome.button.login}"
                   tabindex="6"
                   type="submit"/>
            <!--<input class="btn btn-success btn-block"-->
                   <!--name="zwdl"-->
                   <!--accesskey="2"-->
                   <!--value="指纹登录"-->
                   <!--tabindex="6"-->
                    <!--/>-->
        </section>
    </form>

    <form th:if="${passwordManagementEnabled}" method="post" id="passwordManagementForm">
        <input type="hidden" name="execution" th:value="${flowExecutionKey}"/>
        <input type="hidden" name="_eventId" value="resetPassword"/>
        <span class="fa fa-unlock"></span>
        <a th:utext="#{screen.pm.button.resetPassword}" href="javascript:void(0)" onclick="$('#passwordManagementForm').submit();" />
        <p/>
    </form>
  
    
    <script type="text/javascript" th:inline="javascript">
        var i = [[#{screen.welcome.button.loginwip}]]
        /*$("#fm1").submit(function() {
            $(":submit").attr("disabled", true);
            $(":submit").attr("value", i);
            return true;
        });*/
    </script>
    
    <script type="text/javascript" th:inline="javascript">
	    function onClick(e, treeId, treeNode) {
	    	
	    	if(treeNode.isParent && treeNode.id != 1){
	    		var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
	    		treeObj.expandNode(treeNode);
	    		
	    	}else{
	    		if(treeNode.id == 1){
		    		$('#txtTreeSelect').val(treeNode.name);
		    		$('#jsbhfm').val("0");
		    		hideMenu();
	    		}else{
	    			$('#txtTreeSelect').val(treeNode.name);
		    		$('#jsbhfm').val(treeNode.id);
		    		hideMenu();
	    		}
	    	}
	    }
	
	    function showMenu() {
	    	var cityObj = $('#zTree');
	    	var cityOffset = cityObj.offset();
	    	$("#menuContent").css({
	    		
	    	}).slideDown("fast");
	    	if($('#treeDemo_1_a').attr('title') == "平台管理员"){
	    		$('#treeDemo_1_switch').removeClass('button').html('&nbsp;&nbsp;&nbsp;');
	    	}
	    	$("body").bind("mousedown", onBodyDown);
	    }
	
	    function hideMenu() {
	    	$("#menuContent").fadeOut("fast");
	    	$("body").unbind("mousedown", onBodyDown);
	    }
	    function onBodyDown(event) {
	    	if (!(event.target.id == "menuBtn" || event.target.id == "menuContent" || $(
	    			event.target).parents("#menuContent").length > 0)) {
	    		hideMenu();
	    	}
	    }
	
	    function filter(treeId, parentNode, childNodes) {
	    	if (!childNodes) return null;
	    	for (var i=0, l=childNodes.length; i<l; i++) {
	    		childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');
	    	}
	    	return childNodes;
	    }
	
	    function addDiyDom(treeId, treeNode) {
			var spaceWidth = 5;
			var switchObj = $("#" + treeNode.tId + "_switch"),
			icoObj = $("#" + treeNode.tId + "_ico");
			switchObj.remove();
			icoObj.before(switchObj);

			if (treeNode.level > 1) {
				var spaceStr = "<span style='display: inline-block;width:" + (spaceWidth * treeNode.level)+ "px'></span>";
				switchObj.before(spaceStr);
			}
		}
	
	    var checkIsInsideIP = function(){
	    	
	    	var request_url = window.location.href;
	    	request_url = request_url.split("://")[1];
	        
	    	var request_address = request_url.split("/")[0];
	        var ipAddress = request_address.split(":")[0];
	        
			console.info("ipAddress==="+ipAddress)

	        if (ipAddress == "127.0.0.1" || ipAddress == "localhost"){
	            return true;
	        }
	        var aryIpAddress = ipAddress.split('.');

	        if (aryIpAddress[0] == "10") {
	            return true;
	        }
	        if (aryIpAddress[0] == "192" && aryIpAddress[1] == "168") {
	            return true;
	        }
	        if (aryIpAddress[0] == "172") {
	            var num = parseInt(aryIpAddress[1]);
	            if (num >= 16 && num <= 31) {
	                return true;
	            }
	        }
	        return false;
	    }
	    
	    var initZTree = function() {
	    	
	    	var flag = checkIsInsideIP();
	    	var manager_url = "";
			console.info("flag==="+flag);
			if (flag) {
				manager_url = "http://192.168.4.108:12102/groups/getJsTreeTypeByGroups"; 
			}else {
				manager_url = "https://bjawd.cross.echosite.cn/groups/getJsTreeTypeByGroups"; 
			}
			
	    	var zNodes =[
		        { id:1, pId:0,type:0, name:"平台管理员",isParent:false},
		        { id:110000000, pId:0,type:1, name:"北京市公安局监所管理总队",isParent:false},
		        { id:3, pId:0,type:2, name:"看守所",isParent:true},
		        { id:4, pId:0,type:3, name:"拘留所",isParent:true},
		        { id:5, pId:0,type:4, name:"戒毒所",isParent:true},
		        { id:6, pId:0,type:5, name:"安康医院",isParent:true},
		    ];
		    var setting = {
	    		view: {
	    			showLine: false,
					showIcon: false,
					selectedMulti: false,
					dblClickExpand: false,
					showTitle:false,
					nameIsHTML: true, //允许name支持html
					addDiyDom: addDiyDom
	    		},
	    		edit: {
					enable: false,
					editNameSelectAll: false
				},
	    		data: {
	    			simpleData: {
	    				enable: true
	    			},
	    
	    		},
	    		async: {
	    			enable: true,
	    			//url:"http://192.168.4.108:12102/groups/getJsTreeTypeByGroups",
	    			url:manager_url,
	    			type : "GET",
	    			dataType : "jsonp", // 返回的数据类型，设置为JSONP方式
	    			autoParam:["type"],
	    			dataFilter: filter
	    		},
	    		callback: {
	    			onClick: onClick,
	    		}
	    	};
			$.fn.zTree.init($("#treeDemo"), setting, zNodes);
			fuzzySearch('treeDemo','#txtTreeSelect',null,true); //初始化模糊搜索方法
	    };
	    
	    /* ztree自动加载所有子节点  */
		function asyncAll() {
			var zTree = $.fn.zTree.getZTreeObj("treeDemo");
			
			var nodes = zTree.getNodes();
			for(var i = 0 ; i < nodes.length ; i++){
				nodes[i].description = ""
				zTree.updateNode(nodes[i]);
			}
			
			asyncNodes(zTree.getNodes());
			
			
		}
		
		function asyncNodes(nodes) {
			if (!nodes) return;
			var zTree = $.fn.zTree.getZTreeObj("treeDemo");
			for (var i=0, l=nodes.length; i<l; i++) {
				if (nodes[i].isParent && nodes[i].zAsync) {
					asyncNodes(nodes[i].children);
				} else {
					zTree.reAsyncChildNodes(nodes[i], "refresh", true);
				}
			}
		}
		
	    $(document).ready(function (){
	    	initZTree();
	    	var treeObj = $("#treeDemo");
	    	treeObj.addClass("showIcon");
			
	    	asyncAll();
	    	
	    	/* treeObj.hover(function () {
				if (!treeObj.hasClass("showIcon")) {
					treeObj.addClass("showIcon");
				}
			}, function() {
				treeObj.removeClass("showIcon");
			}); */
	    });
    </script>
     <!--   <div th:replace="fragments/loginsidebar"/> -->
</div>
